class Model{constructor(){this.items=localStorage.getItem("items")?JSON.parse(localStorage.getItem("items")):[]}addItem(t){this.items.push(t),this.onChange(this.items),this.saveData()}deleteItem(t){const e=this.items.find(e=>e.id===t);-1!==e&&(this.items.splice(e,1),this.onChange(this.items),this.saveData())}saveData(){localStorage.setItem("items",JSON.stringify(this.items))}bindOnChange(t){this.onChange=t}get balance(){return this.items.reduce((t,e)=>t+("Income"===e.type?e.amount:-e.amount),0)}}class View{constructor(){this.balance=this.getElement("#balance"),this.balanceSection=this.getElement("#section-balance"),this.amountInput=this.getElement("#amount"),this.descInput=this.getElement("#description"),this.typeInput=this.getElement("#type"),this.addButton=this.getElement("#add"),this.itemsTable=this.getElement("#items-table"),this.itemsTableBody=this.getElement("#items"),this.emptyState=this.getElement("#empty-state")}getElement(t){return document.querySelector(t)}bindAddItem(t){this.addButton.addEventListener("click",e=>{if(!this.amountInput.value.length||!this.descInput.value.length)return UIkit.notification({message:"<span uk-icon='icon: close'></span> Incomplete item information.",status:"danger",pos:"top-left"}),e.preventDefault();const n={amount:Number(this.amountInput.value),desc:this.descInput.value,type:this.typeInput.value};t(n),UIkit.notification({message:"<span uk-icon='icon: check'></span> Added new item!",status:"success",pos:"top-left"}),this.amountInput.value="",this.descInput.value="",this.typeInput.selectedIndex=0})}bindOnDelete(t){this.onDelete=t}bindAmountInputValidation(t){this.amountInput.addEventListener("keyup",()=>{t(amount)})}updateView(t,e){if(this.balance.textContent=formatMoney(e),this.balanceSection.style.backgroundColor=0===e?"#616161":e>0?"#388E3C":"#D32F2F",!t.length)return this.emptyState.style.display="block",void(this.itemsTable.style.display="none");this.itemsTableBody.innerHTML="",this.itemsTable.style.display="table",this.emptyState.style.display="none";for(const e of t){const t=document.createElement("tr"),n=document.createElement("td");n.textContent=formatMoney(e.amount),t.appendChild(n);const i=document.createElement("td");i.textContent=e.desc,t.appendChild(i);const s=document.createElement("td");s.textContent=e.type,t.appendChild(s);const a=document.createElement("td"),o=document.createElement("a");o.setAttribute("class","uk-icon-link"),o.setAttribute("uk-icon","trash"),o.addEventListener("click",()=>{this.onDelete&&(this.onDelete(e.id),UIkit.notification({message:"<span uk-icon='icon: trash'></span> Deleted item!",status:"primary",pos:"top-left"}))}),a.appendChild(o),t.appendChild(a),this.itemsTableBody.appendChild(t)}}}class Controller{constructor(t,e){this.model=t,this.view=e,this.model.bindOnChange(this.onItemsChange),this.view.bindAddItem(this.onAddItem),this.view.bindOnDelete(this.onDeleteItem),this.view.bindAmountInputValidation(this.validateAmountInput),this.onItemsChange(this.model.items)}onItemsChange=t=>{this.view.updateView(t,this.model.balance)};onAddItem=t=>{this.model.addItem({id:generateID(),...t})};onDeleteItem=t=>{this.model.deleteItem(t)};validateAmountInput=t=>{isValidAmount(t.value)||(t.value=t.value.slice(0,-1))}}const app=new Controller(new Model,new View);function isValidAmount(t){return isFinite(t)&&/^\d+((\.\d{1,2})?$)|(\.$)/.test(t)}function generateID(){return Math.random().toString(36).substr(2,9)}function formatMoney(t){return`${t>=0?"":"-"}$${Math.abs(t).toFixed(2)}`}
